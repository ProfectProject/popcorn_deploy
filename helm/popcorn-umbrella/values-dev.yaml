# Development environment overrides
global:
  environment: dev
  imageTag: test-113
  
  # 개발 환경 데이터베이스 (로컬 또는 개발 RDS)
  database:
    host: postgres.popcorn-dev.svc.cluster.local
    port: 5432
    name: popcorn
    
  # 개발 환경 Redis (로컬 또는 개발 ElastiCache)
  redis:
    host: redis.popcorn-dev.svc.cluster.local
    port: 6379
    
  # 개발 환경 Kafka
  kafka:
    bootstrapServers: kafka.popcorn-dev.svc.cluster.local:9092

  frontend:
    appUrl: "https://dev.goormpopcorn.shop"
    apiBaseUrl: "https://api-dev.goormpopcorn.shop"
    storeApiBaseUrl: "https://api-dev.goormpopcorn.shop"
    orderQueryApiBaseUrl: "https://api-dev.goormpopcorn.shop"
    paymentApiBaseUrl: "https://api-dev.goormpopcorn.shop"

otelJavaDefaults:
  extraInitContainers: &otelJavaExtraInitContainers
    - name: otel-javaagent-init
      image: curlimages/curl:8.12.1
      imagePullPolicy: IfNotPresent
      command:
        - sh
        - -c
      args:
        - >
          set -euo pipefail;
          curl -fsSL https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/download/v2.25.0/opentelemetry-javaagent.jar
          -o /otel-auto-instrumentation/opentelemetry-javaagent.jar
      volumeMounts:
        - name: otel-auto-instrumentation
          mountPath: /otel-auto-instrumentation
  extraVolumeMounts: &otelJavaExtraVolumeMounts
    - name: otel-auto-instrumentation
      mountPath: /otel-auto-instrumentation
  extraVolumes: &otelJavaExtraVolumes
    - name: otel-auto-instrumentation
      emptyDir: {}
  commonEnv: &otelJavaCommonEnvDev
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector-opentelemetry-collector.monitoring.svc.cluster.local:4318"
    OTEL_EXPORTER_OTLP_PROTOCOL: "http/protobuf"
    OTEL_TRACES_EXPORTER: "otlp"
    OTEL_METRICS_EXPORTER: "otlp"
    OTEL_LOGS_EXPORTER: "none"
    OTEL_INSTRUMENTATION_LOGBACK_APPENDER_ENABLED: "true"
    OTEL_METRIC_EXPORT_INTERVAL: "30000"
    OTEL_RESOURCE_ATTRIBUTES: "service.namespace=popcorn,deployment.environment=dev"

# 개발 환경 리소스 최소화
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-front
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  env:
    NEXT_PUBLIC_APP_URL: "{{ .Values.global.frontend.appUrl }}"
    NEXT_PUBLIC_API_BASE_URL: "{{ .Values.global.frontend.apiBaseUrl }}"
    NEXT_PUBLIC_STORE_API_BASE_URL: "{{ .Values.global.frontend.storeApiBaseUrl }}"
    NEXT_PUBLIC_ORDERQUERY_API_BASE_URL: "{{ .Values.global.frontend.orderQueryApiBaseUrl }}"
    NEXT_PUBLIC_PAYMENT_API_BASE_URL: "{{ .Values.global.frontend.paymentApiBaseUrl }}"
    NEXT_PUBLIC_TOSS_CLIENT_KEY:
      valueFrom:
        secretKeyRef:
          name: payment-api-keys
          key: TOSS_PAYMENTS_CLIENT_KEY
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  ingress:
    enabled: false

gateway:
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-api-gateway
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "gateway"
    SPRING_PROFILES_ACTIVE: "dev"
    LOGGING_LEVEL_ROOT: "DEBUG"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-gateway-config"
    - secretRef:
        name: "{{ .Release.Name }}-gateway-secret"
        optional: true
  ingress:
    enabled: false  # 개발 환경에서는 Ingress 비활성화

users:
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-user
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "users"
    SPRING_PROFILES_ACTIVE: "dev"
    SPRING_JPA_SHOW_SQL: "true"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-users-config"

stores:
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-store
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "stores"
    SPRING_PROFILES_ACTIVE: "dev"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-stores-config"
    - secretRef:
        name: "{{ .Release.Name }}-stores-secret"
        optional: true

order:
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-order
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "order"
    SPRING_PROFILES_ACTIVE: "dev"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-order-config"
    - secretRef:
        name: "{{ .Release.Name }}-order-secret"
        optional: true

# 개발 환경에서는 모든 서비스 활성화
payment:
  enabled: true  # 활성화
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-payment
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "payment"
    SPRING_PROFILES_ACTIVE: "dev"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-payment-config"
    - secretRef:
        name: "{{ .Release.Name }}-payment-secret"
        optional: true
  
order-query:
  enabled: true  # 활성화
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-order-query
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "order-query"
    SPRING_PROFILES_ACTIVE: "dev"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-order-query-config"
    - secretRef:
        name: "{{ .Release.Name }}-order-query-secret"
        optional: true

checkins:
  enabled: true  # 활성화
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-checkin
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "checkins"
    SPRING_PROFILES_ACTIVE: "dev"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-checkins-config"
    - secretRef:
        name: "{{ .Release.Name }}-checkins-secret"
        optional: true

coupon:
  enabled: true
  replicaCount: 1
  image:
    repository: 375896310755.dkr.ecr.ap-northeast-2.amazonaws.com/goorm-popcorn-coupon
    tag: test-113
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  extraInitContainers: *otelJavaExtraInitContainers
  extraVolumeMounts: *otelJavaExtraVolumeMounts
  extraVolumes: *otelJavaExtraVolumes
  env:
    <<: *otelJavaCommonEnvDev
    OTEL_SERVICE_NAME: "coupon"
    SPRING_PROFILES_ACTIVE: "dev"
    SERVER_PORT: "8080"
    JAVA_TOOL_OPTIONS: "-javaagent:/otel-auto-instrumentation/opentelemetry-javaagent.jar"
  rollout:
    enabled: true
    keepDeployment: false
    replicas: 1
    strategy: blueGreen
    blueGreen:
      autoPromotionEnabled: true
      scaleDownDelaySeconds: 30
      previewReplicaCount: 1
    canary:
      maxSurge: "25%"
      maxUnavailable: 0
  envFrom:
    - configMapRef:
        name: "{{ .Release.Name }}-coupon-config"
    - secretRef:
        name: database-users
        optional: true
