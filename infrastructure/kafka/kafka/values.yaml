# Kafka 기본 설정 (KRaft 모드)

# Bitnami 무료 티어 제약으로 latest 태그를 사용
image:
  registry: docker.io
  repository: bitnami/kafka
  tag: latest

# controller 노드가 broker 역할을 함께 수행하는 KRaft 구성
controller:
  replicaCount: 3
  controllerOnly: false

  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  persistence:
    enabled: true
    storageClass: gp3
    size: 10Gi

  logPersistence:
    enabled: true
    storageClass: gp3
    size: 5Gi

  pdb:
    create: true
    minAvailable: 2

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: kafka
            topologyKey: topology.kubernetes.io/zone

broker:
  replicaCount: 0

listeners:
  client:
    protocol: PLAINTEXT
  controller:
    protocol: PLAINTEXT
  interbroker:
    protocol: PLAINTEXT
  external:
    protocol: PLAINTEXT

service:
  type: ClusterIP
  ports:
    client: 9092
    controller: 9093
    interbroker: 9094
    external: 9095

externalAccess:
  enabled: false

metrics:
  jmx:
    enabled: true

config:
  # 로그 보관 설정
  log.retention.hours: 168
  log.retention.bytes: 1073741824
  log.segment.bytes: 1073741824

  # 복제 설정
  offsets.topic.replication.factor: 3
  transaction.state.log.replication.factor: 3
  transaction.state.log.min.isr: 2
  default.replication.factor: 3
  min.insync.replicas: 2

  # 압축 설정
  compression.type: producer

  # 자동 토픽 생성
  auto.create.topics.enable: true

  # 파티션 설정
  num.partitions: 3
