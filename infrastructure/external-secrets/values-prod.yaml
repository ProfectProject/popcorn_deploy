# External Secrets Operator Helm Values - Prod 환경

# 레플리카 수 (Prod는 고가용성)
replicaCount: 2

# 이미지 설정
image:
  repository: ghcr.io/external-secrets/external-secrets
  pullPolicy: IfNotPresent
  tag: v0.9.13

# 리소스 제한 (Prod는 충분한 리소스)
resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 512Mi

# ServiceAccount 설정
serviceAccount:
  create: true
  name: external-secrets-sa
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::375896310755:role/ExternalSecretsRole-goorm-popcorn-prod

# 보안 컨텍스트
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# 로그 레벨
logLevel: info

# Webhook 설정
webhook:
  create: true
  replicaCount: 2
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# Cert Controller 설정
certController:
  create: true
  replicaCount: 2
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# 메트릭 설정
metrics:
  enabled: true
  service:
    enabled: true
    port: 8080

# 프로메테우스 모니터링
prometheus:
  enabled: true
  service:
    port: 8080

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Node Selector (Karpenter 노드 허용)
nodeSelector: {}

# Tolerations (Spot 노드 허용)
tolerations:
  - key: karpenter.sh/spot
    operator: Exists
    effect: NoSchedule

# Affinity (Spot 노드 선호, 고가용성)
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: karpenter.sh/capacity-type
              operator: In
              values:
                - spot
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - external-secrets
          topologyKey: kubernetes.io/hostname
