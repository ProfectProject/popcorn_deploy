# Mimir 운영 환경 설정

# 분산 모드
deploymentMode: Distributed

mimir:
  structuredConfig:
    multitenancy_enabled: false
    
    blocks_storage:
      backend: filesystem
      filesystem:
        dir: /data/blocks
    
    limits:
      ingestion_rate: 50000
      ingestion_burst_size: 100000
      max_global_series_per_user: 1000000
      max_global_series_per_metric: 100000

# Distributor
distributor:
  replicas: 1
  
  resources:
    requests:
      cpu: 150m
      memory: 256Mi
    limits:
      cpu: 300m
      memory: 512Mi
  
  autoscaling:
    enabled: false  # true → false
    minReplicas: 1
    maxReplicas: 3  # 5 → 3
    targetCPUUtilizationPercentage: 70

# Ingester
ingester:
  replicas: 2
  
  resources:
    requests:
      cpu: 400m
      memory: 768Mi
    limits:
      cpu: 1000m
      memory: 1.5Gi
  
  persistence:
    enabled: true
    storageClass: gp3
    size: 30Gi
  
  zoneAwareReplication:
    enabled: false  # true → false (단순화)

# Querier
querier:
  replicas: 1
  
  resources:
    requests:
      cpu: 200m
      memory: 384Mi
    limits:
      cpu: 500m
      memory: 768Mi

# Query Frontend
query_frontend:
  replicas: 1
  
  resources:
    requests:
      cpu: 150m
      memory: 256Mi
    limits:
      cpu: 300m
      memory: 512Mi

# Store Gateway
store_gateway:
  replicas: 1
  
  resources:
    requests:
      cpu: 200m
      memory: 384Mi
    limits:
      cpu: 500m
      memory: 768Mi
  
  persistence:
    enabled: true
    storageClass: gp3
    size: 30Gi

# Compactor
compactor:
  replicas: 1
  
  resources:
    requests:
      cpu: 200m
      memory: 384Mi
    limits:
      cpu: 500m
      memory: 768Mi
  
  persistence:
    enabled: true
    storageClass: gp3
    size: 30Gi
