apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  # Discord ì„œë¹„ìŠ¤ ì„¤ì •
  service.discord: |
    token: $discord-webhook-url
  
  # ë°°í¬ ì„±ê³µ í…œí”Œë¦¿
  template.app-deployed: |
    message: |
      âœ… **ë°°í¬ ì„±ê³µ**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.spec.destination.namespace}}
      **ìƒíƒœ**: {{.app.status.operationState.phase}}
      **ë™ê¸°í™” ë¦¬ë¹„ì „**: {{.app.status.sync.revision}}
      **ì‹œê°„**: {{.app.status.operationState.finishedAt}}
      
      [ArgoCDì—ì„œ ë³´ê¸°]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
  
  # ë°°í¬ ì‹¤íŒ¨ í…œí”Œë¦¿
  template.app-sync-failed: |
    message: |
      âŒ **ë°°í¬ ì‹¤íŒ¨**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.spec.destination.namespace}}
      **ìƒíƒœ**: {{.app.status.operationState.phase}}
      **ì—ëŸ¬ ë©”ì‹œì§€**: {{.app.status.operationState.message}}
      **ì‹œê°„**: {{.app.status.operationState.finishedAt}}
      
      [ArgoCDì—ì„œ ë³´ê¸°]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
  
  # í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨ í…œí”Œë¦¿
  template.app-health-degraded: |
    message: |
      âš ï¸ **ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ì´ìƒ**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.spec.destination.namespace}}
      **í—¬ìŠ¤ ìƒíƒœ**: {{.app.status.health.status}}
      **ë©”ì‹œì§€**: {{.app.status.health.message}}
      
      [ArgoCDì—ì„œ ë³´ê¸°]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
  
  # Out of Sync í…œí”Œë¦¿
  template.app-sync-status-unknown: |
    message: |
      ğŸ”„ **ë™ê¸°í™” í•„ìš”**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.spec.destination.namespace}}
      **ë™ê¸°í™” ìƒíƒœ**: {{.app.status.sync.status}}
      
      [ArgoCDì—ì„œ ë³´ê¸°]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
  
  # íŠ¸ë¦¬ê±° ì„¤ì •
  trigger.on-deployed: |
    - description: ë°°í¬ ì„±ê³µ ì‹œ ì•Œë¦¼
      send:
      - app-deployed
      when: app.status.operationState.phase in ['Succeeded']
  
  trigger.on-sync-failed: |
    - description: ë°°í¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼
      send:
      - app-sync-failed
      when: app.status.operationState.phase in ['Error', 'Failed']
  
  trigger.on-health-degraded: |
    - description: í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼
      send:
      - app-health-degraded
      when: app.status.health.status == 'Degraded'
  
  trigger.on-sync-status-unknown: |
    - description: Out of Sync ì‹œ ì•Œë¦¼
      send:
      - app-sync-status-unknown
      when: app.status.sync.status == 'Unknown'
  
  # ê¸°ë³¸ êµ¬ë… ì„¤ì • (ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ìš©)
  subscriptions: |
    - recipients:
      - discord
      triggers:
      - on-deployed
      - on-sync-failed
      - on-health-degraded
